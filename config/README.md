# Configuration Guide

This directory contains configuration files for the demo-ui application. Configuration is loaded at runtime from JSON files, allowing you to deploy the same Docker image to multiple instances with different settings.

## Quick Start

1. Copy the example configuration:
   ```bash
   cp config/app-config.example.json config/app-config.json
   ```

2. Edit `config/app-config.json` with your values

3. Run with Docker Compose:
   ```bash
   docker-compose up
   ```

Or with standalone Docker:
```bash
docker run -p 80:80 -v ./config/app-config.json:/config/app-config.json:ro demo-ui:latest
```

## Configuration Files

### `default-config.json`
Built-in default configuration that ships with the Docker image. Used when no custom config is provided. **Do not edit this file** - it's baked into the Docker image during build.

### `app-config.example.json`
Template configuration file. Copy this to `app-config.json` and customize for your deployment.

### `app-config.json`
Your custom configuration (gitignored). This file is mounted into the container at runtime.

## Configuration Schema

### Complete Example

```json
{
  "floor": {
    "width": 50,
    "length": 30
  },
  "zone": {
    "id": "zone-warehouse-1",
    "position": [7.815694, 48.130216],
    "groundControlPoints": [
      {
        "wgs84": [7.815694, 48.130216],
        "local": [0, 0]
      },
      {
        "wgs84": [7.816551, 48.130216],
        "local": [50, 0]
      }
    ]
  },
  "fences": [
    {
      "id": "fence-1",
      "name": "Restricted Area",
      "region": {
        "type": "Polygon",
        "coordinates": [[[15, 5], [35, 5], [35, 15], [15, 15], [15, 5]]]
      },
      "floor": 0,
      "crs": "local"
    }
  ],
  "initialData": {
    "loadInitialData": true,
    "providers": [...],
    "trackables": [...],
    "locations": {...}
  }
}
```

### Field Descriptions

#### `floor` (required)
Floor plan dimensions in meters.

- **`width`** (number): Floor width in meters
- **`length`** (number): Floor length in meters

Example:
```json
{
  "floor": {
    "width": 50,
    "length": 30
  }
}
```

#### `zone` (required)
Geographic reference information for the floor plan.

- **`id`** (string, optional): Zone identifier for API calls
- **`position`** (array): Reference position as `[longitude, latitude]`
- **`groundControlPoints`** (array): Array of GCP objects mapping WGS84 to local coordinates

Ground Control Point structure:
- **`wgs84`**: `[longitude, latitude]` in WGS84 coordinate system
- **`local`**: `[x, y]` in local coordinate system (meters)

Example:
```json
{
  "zone": {
    "id": "warehouse-floor-1",
    "position": [7.815694, 48.130216],
    "groundControlPoints": [
      {
        "wgs84": [7.815694, 48.130216],
        "local": [0, 0]
      },
      {
        "wgs84": [7.816551, 48.130216],
        "local": [50, 0]
      },
      {
        "wgs84": [7.815694, 48.13031],
        "local": [0, 30]
      },
      {
        "wgs84": [7.816551, 48.13031],
        "local": [50, 30]
      }
    ]
  }
}
```

#### `fences` (required)
Array of geofence definitions.

Each fence object:
- **`id`** (string): Unique fence identifier
- **`name`** (string, optional): Human-readable fence name
- **`region`** (object): GeoJSON geometry (Point or Polygon)
- **`floor`** (number, optional): Floor number
- **`crs`** (string, optional): Coordinate reference system (`"local"` or `"wgs84"`)

Example:
```json
{
  "fences": [
    {
      "id": "fence-restricted-1",
      "name": "Restricted Zone",
      "region": {
        "type": "Polygon",
        "coordinates": [
          [
            [15, 5],
            [35, 5],
            [35, 15],
            [15, 15],
            [15, 5]
          ]
        ]
      },
      "floor": 0,
      "crs": "local"
    }
  ]
}
```

#### `initialData` (required)
Demo data to load on application startup.

- **`loadInitialData`** (boolean): Whether to load demo providers/trackables
- **`providers`** (array): Array of location provider objects
- **`trackables`** (array): Array of trackable objects
- **`locations`** (object): Map of initial locations keyed by provider/trackable ID

Example:
```json
{
  "initialData": {
    "loadInitialData": true,
    "providers": [
      {
        "id": "provider-uwb-001",
        "type": "uwb",
        "name": "UWB Tag 1"
      }
    ],
    "trackables": [
      {
        "id": "trackable-asset-001",
        "type": "omlox",
        "name": "Asset #001",
        "location_providers": ["provider-uwb-001"]
      }
    ],
    "locations": {
      "provider-uwb-001": {
        "position": {
          "type": "Point",
          "coordinates": [10, 20]
        },
        "source": "demo-zone",
        "provider_type": "uwb",
        "provider_id": "provider-uwb-001",
        "crs": "local",
        "floor": 0,
        "accuracy": 0.5
      }
    }
  }
}
```

## Common Scenarios

### Minimal Configuration (No Demo Data)

```json
{
  "floor": {
    "width": 50,
    "length": 30
  },
  "zone": {
    "id": null,
    "position": [0, 0],
    "groundControlPoints": [
      {"wgs84": [0, 0], "local": [0, 0]},
      {"wgs84": [0.001, 0], "local": [50, 0]},
      {"wgs84": [0, 0.001], "local": [0, 30]},
      {"wgs84": [0.001, 0.001], "local": [50, 30]}
    ]
  },
  "fences": [],
  "initialData": {
    "loadInitialData": false,
    "providers": [],
    "trackables": [],
    "locations": {}
  }
}
```

### Different Floor Dimensions

```json
{
  "floor": {
    "width": 100,
    "length": 60
  },
  ...
}
```

### Multiple Fences

```json
{
  "fences": [
    {
      "id": "fence-zone-a",
      "name": "Zone A",
      "region": {...},
      "floor": 0,
      "crs": "local"
    },
    {
      "id": "fence-zone-b",
      "name": "Zone B",
      "region": {...},
      "floor": 0,
      "crs": "local"
    }
  ]
}
```

## Validation

The application validates configuration on startup. If validation fails, an error message will be displayed in the UI and logged to the console.

Required fields:
- `floor.width` (number)
- `floor.length` (number)
- `zone.position` (array)
- `zone.groundControlPoints` (array)
- `fences` (array)
- `initialData` (object)

## Troubleshooting

### Configuration not loading
- Check that the config file is valid JSON (use a JSON validator)
- Verify the file is mounted correctly: `docker exec <container> cat /config/app-config.json`
- Check container logs: `docker logs <container>`

### Application shows default values
- Volume mount may not be working - verify Docker Compose volumes configuration
- Config file may have validation errors - check console logs

### Invalid configuration error
- Ensure all required fields are present
- Check that numeric values are numbers, not strings
- Verify GeoJSON structure for fences (closed polygon rings)

## See Also

- [DEPLOYMENT.md](../DEPLOYMENT.md) - Deployment guide for different platforms
- [_concept/AWS_SETUP.md](../_concept/AWS_SETUP.md) - AWS-specific deployment guide




